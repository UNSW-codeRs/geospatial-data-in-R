---
title: "Geospatial tutorial - section 1"
author: "JR Ferrer-Paris"
---
## Creating a spatial object in R

For the first part of this tutorial we will create our own spatial objects.

### Create points using package `sf`

There are many alternative ways to define and work with geo-spatial data in R, but the _simple features_ approach in package `sf` has many advantages and has become the _new_ standard.

Simple features are a standardized way to encode spatial vector data. This package binds to several external libraries like `GDAL`, `GEOS` and `PROJ` for many spatial operations.

If you want to understand simple features in R, you should visit the [documentation of the `sf` package](https://r-spatial.github.io/sf/articles/).

Functions from package `sf` have the prefix `st_`. Many of these functions are described by the _simple features_ standard, so, if you are familiar with spatial databases such as PostGIS and other GIS software, you might recognise many of these. 

### The geometry

A simple feature needs to have a _geometry_, this can be a point, multi-point, linestring, multi-linestring, polygon, multi-polygon, it can also be linked to a collection of several geometries.

In R you can use this function to define a point geometry:

```{r}
my_geom <- st_point(c(22.431028, 37.075074))
```

For geospatial data we need to define a coordinate reference system (_crs_) to interpret these coordinates correctly. They are usually defined by several parameters in a standard format (with heavy use of geospatial jargon), but there are handy shortcuts for the most common examples. Here we will focus on plain latitude and longitude coordinates, known as the _latlong_ projection based on the _WGS84_ datum, this is also referred to as _EPSG:4326_ (Check details at https://epsg.io/4326)

```{r}
my_crs <- st_crs("+proj=latlong +datum=WGS84")
```

### The data

Typically you will want to attach one or more attributes or variables to your geometry, for example we can start with a text, and maybe a url link in a data frame (or a tibble):

```{r points}
data <- data.frame(text='This is Sparta!',
             url='https://64.media.tumblr.com/c963fce8a6e638323f5e60df33c127f3/tumblr_mq3bykOEmD1s9xi1so1_500.gif')
```

But you are not limited by this, you can have a data frame with many columns, each column can represent a variable, a measurement, you can have factors, texts, colors, etc.

Each row in the data frame represents an observation or element, so they need to match the number of spatial features. In this case it is easy with just one point and one row in the data frame, but keep this in mind when creating your own objects!

### Bringing geometry and data together

So we are now ready to make our _simple feature_ object, 

One way to put this together and create a simple feature with function `st_sf` is this:

```{r}
sparta <- st_sf(data, 
                crs=my_crs,
                geometry=st_sfc(my_geom, crs=my_crs))
```

Notice that I am using `st_sfc` to combine the geometry and _crs_ into a _simple feature geometry list column_.

If we want to combine several points into one _simple feature_ object, and assuming all share the same _crs_:

```{r}
pt1 <- st_point(c(23.978333, 38.118056))
pt2 <- st_point(c( 23.2, 39.05))
pt3 <- st_point(c(20.716667, 38.366667))

data <- data.frame(name=c('Marathon','Arthemision','Ithaca'), famous_for=c('Battle of Marathon','Battle of Arthemision',"Homer's Odyssey"), url=c('https://en.wikipedia.org/wiki/Battle_of_Marathon','https://en.wikipedia.org/wiki/Battle_of_Artemisium','https://en.wikipedia.org/wiki/Ithaca'), year=c(-490,-480,-800))

not_sparta <- st_sf(data, 
                crs=my_crs,
                geometry=st_sfc(pt1, pt2,pt3))

```

###

This object has many more attributes than your usual data frame:
```{r, paged.print=FALSE}
not_sparta
```

###

More important, this object has all we need to display information on a map:

```{r}
mapview(sparta, popup = popupImage(img=sparta$url, src ="remote")) + mapview(not_sparta, col.regions = "blanchedalmond")
```

### Exercise 1

Now that we know wherelet's create our own simple feature object for this tutorial. 

We want to define a point for the University of Bayreuth ([Universität Bayreuth](https://uni-bayreuth.de/)) in Franconia, Germany with the supplied coordinates and _crs_, fill the blanks and hit run 

```{r sfex1, exercise = TRUE}
#my_data <- ____(full_name='Universität Bayreuth',
#             url='https://uni-bayreuth.de/')
#my_crs <- ____("EPSG:4326")
#my_geom <- ____(c(11.585833, 49.928889))
#UBT <- st_sf(my_data, 
#               crs=my_crs,
#              geometry=____)
```

```{r sfex1-solution}
my_data <- data.frame(full_name='Universität Bayreuth',
             url='https://uni-bayreuth.de/')
my_crs <- st_crs("EPSG:4326")
my_geom <- st_point(c(11.585833, 49.928889))
UBT <- st_sf(my_data, 
               crs=my_crs,
              geometry=st_sfc(my_geom))
```

<div id="sfex1-hint">
**Hint:** You need to define the data and the simple feature collection to create your object. Use functions `st_point`, `st_crs` and `st_sfc`.
</div>

```{r sfex1-check}
"Great work!\nWe will continue exploring Franconia in the next sections"
```
