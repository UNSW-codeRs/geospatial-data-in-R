
## Kriging

In Geostatistics the term **Kriging** is used for a family of models that minimise the spatial error and can be used for spatial interpolation and prediction. Here we use **Indicator kriging** to interpolate the probability of $Z = \mathrm{Tree\ cover} > 2$ from out measurement points into a regular grid.

Function `krige` is a simple wrapper method around other functions in the `gstat` package for univariate kriging prediction and conditional simulation methods. See the help pages of the functions `gstat` and `predict` for more details.

Now, all of our previous steps come together:

```{r kriging_fit, context = "setup"}
ik <- krige(Z ~ 1, # our target variable
           as_Spatial(data_jbm), # our spatial data
           prd.grd, # the regular grid for prediction 
           variogram_model) # the spatial autocorrelation

```

Run this chunk of code to look at the structure of the output object using the function `str`:

```{r kriging_obj, exercise = TRUE}
str(ik)
```

This class of objects come from the deprecated `sp` package, and the different slots (symbolised by the `@`) show different component of the object.

The `@data` slot includes two variables: the spatial prediction (`var1.pred`) and the variance of the prediction (`var1.var`)

### Visualise the prediction

We use here the `spplot` function from package `sp` to look at the prediction:

```{r kriging_pred, exercise = TRUE}
spplot(ik["var1.pred"],
       main = "indicator kriging predictions",
       sub = "Z = Tree Cover > 2")
```

### Visualise the variance

Now again for the plot of the prediction variance:

```{r kriging_var, exercise = TRUE}
spplot(ik["var1.var"],
       main = "indicator kriging variance",
       sub = "Z = Tree Cover > 2")
```

You can think of kriging as a sophisticated form of spatial interpolation. As such, the predictions should match existing observations, and the variance at these points should be minimal. Let's compare the prediction with the observed values:


```{r kriging_var, exercise = TRUE}
spplot(ik["var1.var"],
       main = "indicator kriging variance",
       sub = "Z = Tree Cover > 2")

bubble(as_Spatial(data_jbm), 
  zcol = "Tree.cover",
  col = "black",
  maxsize = 1.5,
  key.entries = 1:4,
  add = T)
```

